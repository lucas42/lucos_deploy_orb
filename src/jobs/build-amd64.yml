# This doesn't call out to another box because circleci runs on amd64
# But might be worth considering spinning up an amd64 build environment for consistency?
environment:
  ARCH: amd64
docker:
  - image: cimg/base:current
steps:
  - checkout
  - setup_remote_docker
  - run:
      name: Build Docker image
      command: PORT=1234 docker compose build
  - fetch-publish-creds
  - run:
      name: Publish Docker Image to Docker Hub
      command: |
        echo "$DOCKERHUB_ACCESS_TOKEN" | docker login --username "$DOCKERHUB_USERNAME" --password-stdin
        PORT=1234 docker compose push
